<%= form_with(model: meal, class: "space-y-4") do |form| %>
  <div>
    <%= form.label :name, "What did you eat?", class: "text-sm font-semibold text-slate-600" %>
    <%= form.text_field :name, required: true, placeholder: "Veggie tacos, sushi night...", class: "mt-1 w-full rounded-2xl border border-slate-200 px-3 py-2 text-slate-900 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
  </div>

  <div class="grid gap-4 md:grid-cols-2">
    <div>
      <%= form.label :source, "Where was it from?", class: "text-sm font-semibold text-slate-600" %>
      <%= form.select :source, Meal.sources.keys.map { |k| [k.titleize, k] }, {}, required: true, class: "mt-1 w-full rounded-2xl border border-slate-200 px-3 py-2 text-slate-900 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
    </div>
    <div>
      <%= form.label :rating, "Rating", class: "text-sm font-semibold text-slate-600" %>
      <div data-controller="star-rating" data-star-rating-min-value="0.5" data-star-rating-max-value="5" data-star-rating-step-value="0.5" class="mt-2 space-y-1">
        <%= form.hidden_field :rating, value: meal.rating || 4.0, data: { star_rating_target: "input" } %>
        <% initial_rating = (meal.rating || 4.0).to_f %>
        <div class="flex items-center gap-3">
          <div
            class="relative inline-flex cursor-pointer gap-1"
            data-star-rating-target="slider"
            data-action="click->star-rating#select keydown->star-rating#keydown"
            role="slider"
            tabindex="0"
            aria-label="Meal rating"
            aria-valuemin="0.5"
            aria-valuemax="5"
            aria-valuenow="<%= initial_rating %>"
          >
            <% 5.times do |index| %>
              <% fill_percent = [[initial_rating - index, 0].max, 1].min * 100 %>
              <div class="relative text-white/25" aria-hidden="true">
                <%= star_outline_svg("h-7 w-7") %>
                <div
                  class="pointer-events-none absolute inset-0 overflow-hidden text-amber-300"
                  data-star-rating-target="fill"
                  style="width: <%= fill_percent %>%;"
                >
                  <%= star_solid_svg("h-7 w-7") %>
                </div>
              </div>
            <% end %>
          </div>
          <span class="text-sm font-semibold text-slate-600" data-star-rating-target="display">
            <%= format("%.1f / 5", initial_rating) %>
          </span>
        </div>
      </div>
    </div>
  </div>

  <div class="grid gap-4 md:grid-cols-2">
    <div>
      <%= form.label :ate_on, "Date", class: "text-sm font-semibold text-slate-600" %>
      <%= form.date_field :ate_on, required: true, class: "mt-1 w-full rounded-2xl border border-slate-200 px-3 py-2 text-slate-900 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
    </div>
    <div>
      <%= form.label :retry_in_days, "Try again in (days)", class: "text-sm font-semibold text-slate-600" %>
      <%= form.number_field :retry_in_days, min: 0, placeholder: "14", class: "mt-1 w-full rounded-2xl border border-slate-200 px-3 py-2 text-slate-900 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
    </div>
  </div>

  <div>
    <%= form.label :notes, "Notes", class: "text-sm font-semibold text-slate-600" %>
    <%= form.text_area :notes, rows: 3, placeholder: "New spice blend, extra crispy?", class: "mt-1 w-full rounded-2xl border border-slate-200 px-3 py-2 text-slate-900 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
  </div>

  <% button_label = meal.persisted? ? "Update meal" : "Save meal" %>
  <%= form.button class: "flex w-full items-center justify-center gap-2 rounded-full bg-slate-900 px-5 py-3 text-base font-semibold text-white shadow-xl shadow-slate-900/30 transition hover:-translate-y-0.5 hover:bg-slate-800 sm:px-6 sm:py-4" do %>
    <span><%= button_label %></span>
    <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14" /><path d="m13 6 6 6-6 6" /></svg>
  <% end %>
<% end %>
